"use strict";(self.modernJsonp=self.modernJsonp||[]).push([[27829],{81447:(e,t,r)=>{r.d(t,{Z:()=>a});var n=r(967312);let i=[{placementId:11,endOnSurfaceChange:!1},{placementId:40001,endOnSurfaceChange:!0},{placementId:29,endOnSurfaceChange:!1}];function a(e){let{checkExperiment:t}=(0,n.FJ)(),r=t("web_experience_framework_view_duration_trial_run").anyEnabled,a=i.find(t=>t.placementId===e);return{enableViewDuration:r&&!!a,endOnSurfaceChange:a?.endOnSurfaceChange??!1}}},496728:(e,t,r)=>{r.d(t,{Xj:()=>h,Si:()=>E,JF:()=>_.Z,yr:()=>b});var n=r(667294),i=r(616550),a=r(778622),s=r(218291);let{Provider:o,get:c,useMaybeHook:l}=(0,s.Z)("ExperienceViewDurationManagerContext");var d=r(302057),u=r(755090),p=r(785893);function h({children:e}){let t=(0,n.useRef)({}),r=(0,i.TH)(),s=()=>0===Object.values(t.current).length||0===Object.keys(t.current).length,c=e=>{if(e)return t.current[e]},l=e=>{let r=e.getExperienceId();return t.current[r]=e,d.ck.log(`[View Duration] - Added experience with id ${r} to experiences in view map.
View ExperienceInView object added: `,t.current[r]),t.current[r]},h=(e,r="unknown")=>{if(0===Object.values(t.current).length)return void(0,a.Su)("RemoveOnEmptyViewMap","[View Duration] Error in removeExperience() - EmptyViewMap - Cannot remove experience from an empty experiences view map.",e,parseInt(e.split(":")[0]||"0",10));if(!t.current[e])return void(0,a.Su)("RemoveOnMissingExperience",`[View Duration] Error in removeExperience() - MissingExperience - Cannot remove experience with id ${e} from experiences in view map as it does not exist.`,e,parseInt(e.split(":")[0]||"0",10));try{t.current[e].addTimeStamp(r,!1,"end")}catch(t){d.ck.error(`[View Duration] - Error occurred while ending experience ${e} view: `,t instanceof Error?t.message:String(t)),(0,a.Su)("EndViewError",t instanceof Error?t.message:String(t),e,parseInt(e.split(":")[0]||"0",10));return}t.current[e].disconnect(),d.ck.log(`[View Duration] - Ended experience with id ${e} to experiences in view map with reason '${r}'.
View time stamps for experience: `,t.current[e].getTimeline(),`
Full experience in view object: `,t.current[e]),(0,a.Xg)({experienceId:e,placementId:t.current[e].getPlacementId(),timeline:t.current[e].getTimelineDeepCopy(),endReason:r}),delete t.current[e]},m=e=>{s()||Object.values(t.current).forEach(e=>{h(e.experienceId,"page-unload")})},g=(0,n.useCallback)(()=>{s()||Object.values(t.current).forEach(e=>{e.getLocation()!==r.pathname&&e.getEndOnSurfaceChange()&&h(e.getExperienceId(),"surface-exit")})},[r]),f=()=>{s()||Object.values(t.current).forEach(e=>{try{e.addTimeStamp("blur",!1,"paused"),d.ck.log(`[View Duration] - Pausing experience ${e.getExperienceId()} view.`)}catch(t){d.ck.error(`[View Duration] - Error occurred while pausing experience ${e.getExperienceId()} view: `,t instanceof Error?t.message:String(t))}})},w=()=>{s()||Object.values(t.current).forEach(e=>{try{let t=e.getStateToResumeTo();e.addTimeStamp("focus",t,"resumed"),d.ck.log(`[View Duration] - Resuming experience ${e.getExperienceId()} view from paused state with inView status: ${t}.`)}catch(t){d.ck.error(`[View Duration] - Error occurred while resuming experience ${e.getExperienceId()} view: `,t instanceof Error?t.message:String(t))}})};(0,n.useEffect)(()=>{g()},[r,g]),(0,u.Z)(()=>(window.addEventListener("beforeunload",m),window.addEventListener("blur",f),window.addEventListener("focus",w),()=>{window.removeEventListener("beforeunload",m),window.removeEventListener("blur",f),window.removeEventListener("focus",w)}));let v=(0,n.useMemo)(()=>({experiencesInView:t.current,getExperience:c,addExperience:l,removeExperience:h}),[t]);return(0,p.jsx)(o,{value:v,children:e})}function m(e,t,r){var n;return(t="symbol"==typeof(n=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"))?n:n+"")in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}let g={start:["active","paused","end"],active:["active","end","paused"],paused:["resumed","paused","end"],resumed:["active","end","paused"],end:[],unknown:["start"]},f=(e,t)=>`${e}->${t}`;class w{constructor(e,t,r,n,i=null,a=[],s=null){m(this,"inView",!1),m(this,"state","unknown"),m(this,"lastInitiator",null),m(this,"endReason",null),m(this,"handleTransitionEdgeCases",(e,t,r,n)=>{let i=f(e,t);return"paused->active"===i&&"IntersectionObserver"===r&&(this.addTimeStamp("IntersectionObserver",n,"paused",0),d.ck.warn(`[View Duration] - âš ï¸ ${i} transition detected with initiator ${r}. Switching to 'paused' state instead.`),!0)}),this.experienceId=e,this.placementId=t,this.location=r,this.endOnSurfaceChange=n,this.observer=i,this.timeline=a,this.elementNode=s,s&&this.initiateObserver(s)}disconnect(){try{if(!this.observer)throw Error("disconnect() - Attempted to disconnect observer, but it has not been initiated yet.");this.observer.disconnect(),this.observer=null}catch(e){d.ck.error("[View Duration] - Error disconnecting observer:",e instanceof Error?e.message:String(e))}}initiateObserver(e){if(e&&!this.observer)this.observer=new IntersectionObserver(([e])=>{let t=this.inView;try{e?.isIntersecting?this.inView=!0:this.inView=!1,this.addTimeStamp("IntersectionObserver",this.inView,0===this.timeline.length?"start":"active")}catch(e){d.ck.error("[View Duration] - Error adding time stamp for IntersectionObserver: ",e instanceof Error?e.message:String(e)),this.inView=t}d.ck.log(`[View Duration] - ${this.inView?"ðŸ‘ï¸ In View":"âŒ Out of View"}`)},{root:null,rootMargin:"0px",threshold:.1}),this.elementNode=e,this.observer.observe(e);else{if(e?.isEqualNode(this.elementNode)){this.observer?.observe(e),this.elementNode=e,d.ck.log(`[View Duration] - Resuming experience ${this.experienceId}.`,e);return}d.ck.warn("[View Duration] - Attempted to initiate observer with a null node or an existing observer. Node:",e)}}hasInitiated(){return null!==this.observer&&null!==this.elementNode}addTimeStamp(e,t,r="unknown",n){if(!this.hasInitiated())throw Error(`addTimeStamp() - Attempted to add a time stamp before the observer has been initiated.

        Initiator: ${e}, 
inView: ${t}, 
newState: ${r}, 
time: ${n}
`);let i=this.getLastTimeStamp()?.state||"unknown";if(!g[i].includes(r)){if(this.handleTransitionEdgeCases(i,r,e,t))return!0;throw Error(`Invalid time stamp state transition: ${f(i,r)}. 
Dropping time stamp.`)}return this.timeline.push({time:n||(0,d.dg)(),initiator:e,inView:t,state:r}),this.state=r,this.inView=t,this.lastInitiator=e,"end"===r&&"blur"!==e&&"focus"!==e&&"IntersectionObserver"!==e&&(this.endReason=e),!0}setEndReason(e){this.endReason=e}isInView(){return this.inView}getViewState(){return this.timeline?.[this.timeline.length-1]?.state??"unknown"}getLastTimeStamp(){return this.timeline.length>0?this.timeline[this.timeline.length-1]:void 0}getTimeStampBeforePause(){if(this.timeline.length<2)throw Error("Attempted to get time stamp before pause, but there are not enough durations");let e=this.timeline[0];for(let t=1;t<this.timeline.length;t+=1){let r=this.timeline[t];if(r?.state==="paused")return e;e=r}}getStateToResumeTo(){let e=[...this.timeline].reverse().find(e=>"paused"===e.state&&"IntersectionObserver"===e.initiator);return e?e.inView:this.getTimeStampBeforePause()?.inView??!1}getState(){return{inView:this.inView,state:this.state,lastInitiator:this.lastInitiator,endReason:this.endReason}}getTimelineDeepCopy(){return this.timeline.map(e=>({...e}))}getExperienceId(){return this.experienceId}getPlacementId(){return this.placementId}getLocation(){return this.location}getEndOnSurfaceChange(){return this.endOnSurfaceChange}getElementNode(){return this.elementNode}getObserver(){return this.observer}getTimeline(){return this.timeline}getLength(){return this.timeline.length}}let{Provider:v,get:x}=(0,s.Z)("ViewDurationContext"),b=x;function E({children:e,experienceId:t,placementId:r,disable:s=!1,endOnSurfaceChange:o=!0}){let c=l(),d=s||!c,{getExperience:u,addExperience:h,removeExperience:m}=c||{getExperience:()=>void 0,addExperience:()=>void 0,removeExperience:()=>void 0},g=(0,n.useRef)(u(t)??null),f=(0,n.useRef)(null),x=(0,i.TH)(),b=(0,n.useCallback)(()=>{try{if(d)return;if(!t||!r)throw Error("[View Duration] AddError - Experience ID and Placement ID are required for starting a view");g.current||(g.current=new w(t,r,x.pathname,o,null,void 0,f.current),h(g.current))}catch(e){(0,a.Su)("StartViewError",e instanceof Error?e.message:String(e),t||"unknown",r||0)}},[t,r,g,h,d,x,o]),E=(0,n.useCallback)(e=>{try{if(d)return;if(!t||!r)throw Error("Experience ID and Placement ID are required for ending a view");g.current?.hasInitiated()&&m(t,e)}catch(e){(0,a.Su)("EndViewError",e instanceof Error?e.message:String(e),t||"unknown",r||0)}},[t,r,g,m,d]),_=(0,n.useCallback)(e=>{d||(g.current?g.current.initiateObserver(e):f.current=e)},[g,d]),S=(0,n.useMemo)(()=>({startView:b,endView:E,experienceInView:g.current,setObserverRef:_}),[b,E,g,_]);return(0,p.jsx)(v,{value:S,children:e})}r(81447);var _=r(794055)},794055:(e,t,r)=>{r.d(t,{M:()=>n,Z:()=>i});let n=e=>"NoStart"===e||"NegativeTotal"===e||"NoEnd"===e||"InvalidTotal"===e;function i(e){let t,r=e.findIndex(e=>"start"===e.state);if(-1===r)throw Error("[View Duration] - No start timestamp found in the timeline.",{cause:"NoStart"});let n=e=>{if(void 0===t)return t=e.inView,!1;let r=t===e.inView;return t=e.inView,r},i=!0,a=0;for(let t of e.slice(r)){let e=t.inView?-t.time:t.time;if("end"===t.state){n(t)||(a+=e),i=!1;break}"resumed"===t.state&&(i=!0),i&&(n(t)||(a+=e),"paused"===t.state&&(i=!1))}if(i)throw Error("[View Duration] - Timeline ended without an end state. Is this experience still in view?",{cause:"NoEnd"});if(a<0)throw Error("[View Duration] - Total duration calculated is negative.",{cause:"NegativeTotal"});if("number"!=typeof a||Number.isNaN(a))throw Error("[View Duration] - Total duration calculated is not a valid number.",{cause:"InvalidTotal"});return a}},732282:(e,t,r)=>{let n;r.d(t,{Af:()=>h,Al:()=>w,Am:()=>_,Ig:()=>b,N:()=>y,NW:()=>f,Sd:()=>S,Su:()=>R,Xg:()=>k,YX:()=>I,be:()=>E,fO:()=>g,kd:()=>V,pz:()=>v,x4:()=>m});var i=r(667294),a=r(578373),s=r(219308),o=r(496728),c=r(794055),l=r(241321),d=r(302057),u=r(397657),p=r(992114);let h=e=>{n=e},m=(e,t)=>a.Z.create("UserExperiencePlatformResource",t?{extra_context:e,targeting:t}:{extra_context:e}).callGet(),g=(e,t)=>r=>a.Z.create("UserExperiencePlatformResource",t?{extra_context:e,targeting:t}:{extra_context:e}).callGet().then(e=>e.resource_response?r((0,l.OD)(e.resource_response.data)):void 0),f=e=>t=>a.Z.create("UserExperiencePlatformResource",{extra_context:e,multiExperiencePlatform:!0}).callGet().then(e=>e.resource_response?t((0,l.xF)(e.resource_response.data)):void 0),w=(e,t,r,i)=>t?Promise.resolve():(i&&(n=i),a.Z.create("UserExperienceResource",{placement_ids:e,extra_context:r||null,targeting:i}).callGet()),v=(e,t,r,i)=>(s,o)=>{if(t)return Promise.resolve();if(i&&(n=i),1===e.length){let t=e[0],n=o().experiences[t];if(JSON.stringify(n?.extraContext||null)===JSON.stringify(r)||(0,d.E3)(n)&&!(r&&Object.keys(r).length>0))return Promise.resolve()}return a.Z.create("UserExperienceResource",{placement_ids:e,extra_context:r||null,targeting:i}).callGet().then(e=>e.resource_response?s((0,l.cL)(e.resource_response.data)):void 0)},x=(e,t,r,i)=>(s,o,c,d=!1,u,p)=>(h,m)=>{let{experiences:f,experiencesMulti:w}=m(),v=null,x=!0;if(d||(v=(x=!!f[s]&&f[s].experience_id===o)?f[s]:Array.isArray(w[s])&&w[s]?.find(e=>e.experience_id===o)),v&&v.experience_id===o||d&&s&&o){let d=a.Z.create(e,{placed_experience_id:`${s}%3A${o}`,extra_context:u??{},targeting:p}),m=x?l.Yb:l.xW;switch(t){case"dismissed":return d.callDelete().then(()=>{h(m(s,o,t)),h(g(void 0,n)),r&&i&&r({event_type:i,object_id_str:o.toString()})});case"completed":return d.callUpdate().then(()=>{!c&&(h(m(s,o,t)),h(g(void 0,n)),r&&i&&r({event_type:i,object_id_str:o.toString()}))});case"viewed":return h(m(s,o,t)),d.callUpdate().then(()=>{1000162===s&&h(g()),r&&i&&r({event_type:i,object_id_str:o.toString()})});case"completedWithoutHomefeed":return d.callUpdate().then(()=>{c||h(m(s,o,t)),r&&i&&r({event_type:i,object_id_str:o.toString()})})}}return Promise.resolve()},b=()=>{let e=(0,s.Z)();return(0,i.useCallback)(x("UserExperienceViewedResource","viewed",e,4503),[e])},E=()=>{let e=(0,s.Z)();return(0,i.useCallback)(x("UserExperienceCompletedResource","completed",e,6567),[e])},_=()=>{let e=(0,s.Z)();return(0,i.useCallback)(x("UserExperienceResource","dismissed",e,6568),[e])},S=()=>{let e=(0,s.Z)();return(0,i.useCallback)(x("UserExperienceCompletedResource","completedWithoutHomefeed",e,6567),[e])},V=(e,t)=>(r,n)=>{let{experiences:i}=n(),a=i[e];a&&a.triggerable_placed_exps&&a.triggerable_placed_exps.length&&a.triggerable_placed_exps.forEach(r=>{let[,n]=r.split(":"),i=t,s=a?.metadata?.[n];s&&(i={...t,..."object"==typeof s?s:{}}),(0,u.Z)({url:`/v3/experiences/${r.replace(":","%3A")}/trigger/`,method:"PUT",data:i?{extra_context:JSON.stringify(i,null,1)}:{}}).then(()=>{((e,t,r={})=>(0,p.nP)(`${e}.${t}`,{sampleRate:1,tags:r}))("experienceservice","experimentTriggerCall.1",{placement_id:e,experience_id:n})})})},I=e=>(t,r)=>{t(V(e));let{experiences:n}=r();return n[e]},y=(e,t,r)=>i=>{r&&(n=r),i(V(e,t)),t&&Object.keys(t).length>0&&i(v([e],!1,t,r))},R=async(e,t,r,n)=>{d.ck.error(t),(0,p.nP)("experience_framework.view_duration.error",{sampleRate:1,tags:{type:e,experience_id:r.split(":")[1],placement_id:n}})},k=e=>{let{experienceId:t,placementId:r,endReason:n,timeline:i}=e;try{let e=(0,o.JF)(i);d.ck.log(`[View Duration] âœ¨ Total duration for experience ${t} is ${e}ms - Sending to statsboard with end reason: ${n}`),(0,p.LY)("experience_framework.view_duration",e,{sampleRate:.2,tags:{placement_id:r,experience_id:t.split(":")[1],end_reason:n}})}catch(e){d.ck.error(`[View Duration] Error calculating total duration for experience ${t}: ${e}`),e instanceof Error&&R((0,c.M)(e.cause)?e.cause:"unknown",e.message,t,r)}}},778622:(e,t,r)=>{r.d(t,{Tl:()=>s,CF:()=>o,fO:()=>n.fO,NW:()=>n.NW,pz:()=>n.pz,YX:()=>n.YX,x4:()=>n.x4,Su:()=>n.Su,Xg:()=>n.Xg,N:()=>n.N,kd:()=>n.kd,be:()=>n.be,Sd:()=>n.Sd,Am:()=>n.Am,Ig:()=>n.Ig,dy:()=>c});var n=r(732282),i=r(578373);let a=(e,t,r,a)=>(s,o)=>c=>{if(s&&s.id){let l=i.Z.create(e,{placed_experience_id:s.id,extra_context:{}});switch(t){case"dismissed":l.callDelete().then(()=>{c((0,n.fO)()),r&&a&&r({event_type:a,object_id_str:s.id.toString()})});break;case"completed":l.callUpdate().then(()=>{o||c((0,n.fO)()),r&&a&&r({event_type:a,object_id_str:s.id.toString()})});break;case"viewed":l.callUpdate().then(()=>{r&&a&&r({event_type:a,object_id_str:s.id.toString()})})}}},s=e=>a("UserExperienceCompletedResource","completed",e,6567),o=a("UserExperienceResource","dismissed"),c=e=>a("UserExperienceViewedResource","viewed",e,4503)},241321:(e,t,r)=>{r.d(t,{OD:()=>o,Yb:()=>s,cL:()=>c,xF:()=>i,xW:()=>a});var n=r(611577);let i=e=>({type:n.$S,payload:{experiencesMulti:e}}),a=(e,t,r)=>({type:n.V$,payload:{placementId:e,experienceId:t,status:r}}),s=(e,t,r)=>({type:n.iY,payload:{placementId:e,experienceId:t,status:r}}),o=e=>({type:n._4,payload:{experiences:e}}),c=e=>({type:n.mR,payload:{experiences:e}})},302057:(e,t,r)=>{r.d(t,{ck:()=>S,wQ:()=>b,A0:()=>g,MQ:()=>m,Cv:()=>f,dg:()=>E,E3:()=>p,Qs:()=>_,nR:()=>h});var n=r(667294),i=r(20256),a=r(316886),s=r(890360);let o=[11,1000168],c={1:{id:1,route:"/",onRoute:s.HV,placements:[11,1000541,1000503,40001]},13:{id:13,route:"/business/hub/",onRoute:s.h3,placements:[1000168]}};var l=r(32526),d=r(611395),u=r(785893);function p(e){return!!e&&0!==e.type}let h=(e,t,r,n,i,a=!0)=>{let s="existingExperience";return n?p(n)?r&&(s="placementInSurface",!r.placements.includes(e))?{shouldRefresh:!0,refreshReasoning:"placementNotInSurface"}:i?(s="inSSRPlacement",o.includes(e)?{shouldRefresh:!1,refreshReasoning:s}:{shouldRefresh:!0,refreshReasoning:"notAnSSRPlacement"}):!a||(s="placementMounted",t.mountedPlacements[e]||t.registeredAfterActionPlacements[e])?{shouldRefresh:!1,refreshReasoning:s}:{shouldRefresh:!0,refreshReasoning:"placementNotMounted"}:{shouldRefresh:!0,refreshReasoning:"experienceNotRenderable"}:{shouldRefresh:!0,refreshReasoning:"noExistingExperience"}},m=(e,t,r)=>{let n=e[r];return t[r]&&p(n)?n:null};function g(e){return e.display_data?.anchor}function f(e){return Object.values(c).find(t=>t.onRoute?t.onRoute(e):t.route===e.pathname)}let w=/<[a]\s+([^>]*)>([^<]*)<\/[a]>/gim,v=/(?:href)=["']?([^"'>\s\\]*)["']?/im,x=/(?:target)=["']?([^"'>\s\\]*)["']?/im,b=e=>{let t=[],r=e.matchAll(w),a=0,s=e=>(e?.split(`
`)||[]).map((e,t)=>(0,u.jsxs)(n.Fragment,{children:[t>0&&(0,u.jsx)("br",{}),(0,u.jsx)(i.xv,{inline:!0,children:e})]},e+t));for(let n of r)if(n&&3===n.length){let r=n[1],o=n[2],c=n.index,l=r?.match(v),p=l&&l.length>1?l[1]:void 0,h=r?.match(x),m=h&&h.length>1?h[1]:void 0;if(c&&p&&o){t.push(s(e.slice(a,c)));let r=!1;r=(0,d.Z)({url:p}),t.push((0,u.jsx)(i.rU,{display:"inline",externalLinkIcon:r?"default":"none",href:p,rel:r?"nofollow":"none",target:"_blank"===m?"blank":void 0,children:o},p)),a=c+n[0]?.length}}return a<e.length&&t.push(s(e.slice(a,e.length))),(0,u.jsx)(i.xv,{inline:!0,children:t})},E=()=>"undefined"!=typeof window&&performance&&performance.now?Math.floor(performance.now()):Math.floor(Date.now()),_=(e,t,r)=>{let n=e&&e[r]?e[r]:void 0,i=t&&Object.keys(t).length>0,s=(0,a.Z1)(n?.extraContext||{},t||{},3),o=p(n)&&!i,c={currentExperienceInPlacement:!!n,hasExtraContext:!!i,sameContext:s,experienceRenderable:o};return n&&s||o?{shouldFetch:!1,logValues:c}:{shouldFetch:!0,logValues:c}},S=(0,l.Z)()&&(0,l.Z)().debug_experience_view_duration?console:{log:(...e)=>{},error:(...e)=>{},warn:(...e)=>{}}},611395:(e,t,r)=>{r.d(t,{Z:()=>i});var n=r(745052);let i=({url:e})=>!!(e&&e.match(/^https{0,1}:\/\//)&&!(0,n.Z)(e))}}]);
//# sourceMappingURL=https://sm.pinimg.com/webapp/27829-d6e42e0f951ef3c2.mjs.map